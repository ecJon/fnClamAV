#!/bin/bash

### This script is called after the user installs the application.

# åˆå§‹åŒ– ClamAV ç—…æ¯’åº“
APP_DIR="$(dirname "$(readlink -f "$0")")/../"
DB_DIR="${APP_DIR}/share/clamav"

# ç¡®ä¿ç—…æ¯’åº“ç›®å½•å­˜åœ¨
mkdir -p "${DB_DIR}"

# å¦‚æžœç›®å½•ä¸ºç©ºï¼Œå°è¯•ä»Žç³»ç»Ÿå¤åˆ¶æˆ–æç¤ºä¸‹è½½
if [ -z "$(ls -A ${DB_DIR}/*.cvd ${DB_DIR}/*.cld 2>/dev/null)" ]; then
    # å¦‚æžœç³»ç»Ÿå·²æœ‰ç—…æ¯’åº“ï¼Œå¤åˆ¶è¿‡æ¥
    if [ -d "/var/lib/clamav" ] && [ -n "$(ls -A /var/lib/clamav/*.cvd /var/lib/clamav/*.cld 2>/dev/null)" ]; then
        echo "ðŸ¦  Copying virus database from system..."
        cp -f /var/lib/clamav/*.cvd /var/lib/clamav/*.cld "${DB_DIR}/" 2>/dev/null || true
    fi
fi

exit 0