<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClamAV æ€æ¯’è½¯ä»¶</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/vue.global.prod.js"></script>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="header">
                <div class="header-content">
                    <div class="logo-area">
                        <img src="./images/icon.png" alt="ClamAV" class="logo" onerror="this.style.display='none'">
                        <h1>ClamAV æ€æ¯’è½¯ä»¶</h1>
                    </div>
                    <div class="status-badge" :class="{ active: systemStatus.is_scanning }">
                        <span class="status-dot"></span>
                        {{ systemStatus.is_scanning ? 'æ‰«æä¸­' : 'å°±ç»ª' }}
                    </div>
                </div>
            </header>

            <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
            <main class="main-content">
                <!-- å¿«é€Ÿæ“ä½œåŒº -->
                <section class="quick-actions">
                    <button class="action-btn primary" @click="startFullScan" :disabled="systemStatus.is_scanning">
                        <span class="btn-icon">ğŸ”</span>
                        <span>{{ systemStatus.is_scanning ? 'æ‰«æè¿›è¡Œä¸­...' : 'å…¨ç›˜æ‰«æ' }}</span>
                    </button>
                    <button class="action-btn secondary" @click="startCustomScan" :disabled="systemStatus.is_scanning">
                        <span class="btn-icon">ğŸ“</span>
                        <span>è‡ªå®šä¹‰æ‰«æ</span>
                    </button>
                    <button class="action-btn secondary" @click="stopScan" :disabled="!systemStatus.is_scanning">
                        <span class="btn-icon">â¹</span>
                        <span>åœæ­¢æ‰«æ</span>
                    </button>
                    <button class="action-btn secondary" @click="startUpdate" :disabled="updateStatus.is_updating">
                        <span class="btn-icon">ğŸ”„</span>
                        <span>{{ updateStatus.is_updating ? 'æ›´æ–°ä¸­...' : 'æ›´æ–°ç—…æ¯’åº“' }}</span>
                    </button>
                </section>

                <!-- æ‰«æè¿›åº¦ -->
                <section v-if="uiState.showProgress" class="scan-progress-card">
                    <h3>æ‰«æè¿›åº¦</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{ width: scanStatus.progress?.percent + '%' }"></div>
                        </div>
                        <span class="progress-text">{{ Math.round(scanStatus.progress?.percent || 0) }}%</span>
                    </div>
                    <div class="progress-info">
                        <p>å·²æ‰«æ: {{ scanStatus.progress?.scanned || 0 }} / {{ scanStatus.progress?.estimated_total || '?' }} æ–‡ä»¶</p>
                        <p v-if="scanStatus.progress?.current_file" class="current-file">
                            æ­£åœ¨æ‰«æ: <code>{{ truncatePath(scanStatus.progress.current_file) }}</code>
                        </p>
                        <p v-if="scanStatus.threats?.count" class="threats-count">
                            å‘ç°å¨èƒ: {{ scanStatus.threats.count }} ä¸ª
                        </p>
                    </div>
                </section>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <section class="stats-grid">
                    <div class="stat-card virus-db-card">
                        <div class="stat-icon">ğŸ›¡ï¸</div>
                        <div class="stat-content">
                            <h4>ç—…æ¯’åº“ç‰ˆæœ¬</h4>
                            <div class="version-details">
                                <div class="version-item">
                                    <span class="version-label">æ¯æ—¥æ›´æ–°</span>
                                    <span class="version-num">{{ virusVersion.daily || 'æœªçŸ¥' }}</span>
                                </div>
                                <div class="version-item">
                                    <span class="version-label">ä¸»åº“</span>
                                    <span class="version-num">{{ virusVersion.main || 'æœªçŸ¥' }}</span>
                                </div>
                                <div class="version-item">
                                    <span class="version-label">å­—èŠ‚ç </span>
                                    <span class="version-num">{{ virusVersion.bytecode || 'æœªçŸ¥' }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-content">
                            <h4>æ‰«æå†å²</h4>
                            <p>{{ scanHistory.length }} æ¬¡</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¦ </div>
                        <div class="stat-content">
                            <h4>éš”ç¦»æ–‡ä»¶</h4>
                            <p>{{ quarantineList.length }} ä¸ª</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âš ï¸</div>
                        <div class="stat-content">
                            <h4>å‘ç°å¨èƒ</h4>
                            <p>{{ totalThreats }} ä¸ª</p>
                        </div>
                    </div>
                </section>

                <!-- Tabå†…å®¹ -->
                <section class="tabs-section">
                    <div class="tabs">
                        <button
                            v-for="tab in tabs"
                            :key="tab.key"
                            class="tab-btn"
                            :class="{ active: activeTab === tab.key }"
                            @click="activeTab = tab.key"
                        >
                            {{ tab.label }}
                        </button>
                    </div>

                    <!-- å¨èƒåˆ—è¡¨ -->
                    <div v-show="activeTab === 'threats'" class="tab-content">
                        <div v-if="threats.length === 0" class="empty-state">
                            <p>æš‚æ— å¨èƒè®°å½•</p>
                        </div>
                        <div v-else class="threats-list">
                            <div v-for="threat in threats" :key="threat.id" class="threat-item">
                                <div class="threat-info">
                                    <h4>{{ threat.virus_name }}</h4>
                                    <p>{{ threat.file_path }}</p>
                                    <small>{{ new Date(threat.detected_time * 1000).toLocaleString() }}</small>
                                </div>
                                <div class="threat-actions">
                                    <button class="btn-small danger" @click="handleThreat(threat.id, 'quarantine')">
                                        éš”ç¦»
                                    </button>
                                    <button class="btn-small" @click="handleThreat(threat.id, 'ignore')">
                                        å¿½ç•¥
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- éš”ç¦»åŒº -->
                    <div v-show="activeTab === 'quarantine'" class="tab-content">
                        <div class="quarantine-header">
                            <button class="btn-small secondary" @click="cleanupQuarantine">æ¸…ç†éš”ç¦»åŒº</button>
                        </div>
                        <div v-if="quarantineList.length === 0" class="empty-state">
                            <p>éš”ç¦»åŒºä¸ºç©º</p>
                        </div>
                        <div v-else class="quarantine-list">
                            <div v-for="item in quarantineList" :key="item.uuid" class="quarantine-item">
                                <div class="quarantine-info">
                                    <h4>{{ item.original_filename }}</h4>
                                    <p>{{ item.virus_name }}</p>
                                    <small>{{ new Date(item.quarantined_time * 1000).toLocaleString() }}</small>
                                </div>
                                <div class="quarantine-actions">
                                    <button class="btn-small primary" @click="restoreQuarantine(item.uuid)">
                                        æ¢å¤
                                    </button>
                                    <button class="btn-small danger" @click="deleteQuarantine(item.uuid)">
                                        åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ‰«æå†å² -->
                    <div v-show="activeTab === 'history'" class="tab-content">
                        <div v-if="scanHistory.length === 0" class="empty-state">
                            <p>æš‚æ— æ‰«æå†å²</p>
                        </div>
                        <div v-else class="history-list">
                            <div v-for="scan in scanHistory" :key="scan.id" class="history-item">
                                <div class="history-info">
                                    <h4>{{ scan.scan_type === 'full' ? 'å…¨ç›˜æ‰«æ' : 'è‡ªå®šä¹‰æ‰«æ' }}</h4>
                                    <p>æ‰«æè·¯å¾„: <span v-if="Array.isArray(scan.paths)">{{ scan.paths.slice(0, 3).join(', ') }}{{ scan.paths.length > 3 ? '...' : '' }}</span><span v-else>{{ scan.paths }}</span></p>
                                    <small>{{ new Date(scan.start_time * 1000).toLocaleString() }}</small>
                                </div>
                                <div class="history-stats">
                                    <span class="status-badge" :class="scan.status">{{ scan.status }}</span>
                                    <span>{{ scan.scanned_files }} / {{ scan.total_files }} æ–‡ä»¶</span>
                                    <span v-if="scan.threats_found > 0" class="threats-count">
                                        {{ scan.threats_found }} å¨èƒ
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ›´æ–°å†å² -->
                    <div v-show="activeTab === 'updates'" class="tab-content">
                        <div class="virus-db-info">
                            <h3>ç—…æ¯’åº“ä¿¡æ¯</h3>
                            <div class="db-version-grid">
                                <div class="db-version-item">
                                    <span class="db-name">Dailyï¼ˆæ¯æ—¥æ›´æ–°ï¼‰</span>
                                    <span class="db-version">{{ virusVersion.daily || 'æœªçŸ¥' }}</span>
                                    <span class="db-desc">æœ€æ–°ç—…æ¯’å®šä¹‰ï¼Œæ¯æ—¥æ›´æ–°</span>
                                </div>
                                <div class="db-version-item">
                                    <span class="db-name">Mainï¼ˆä¸»åº“ï¼‰</span>
                                    <span class="db-version">{{ virusVersion.main || 'æœªçŸ¥' }}</span>
                                    <span class="db-desc">åŸºç¡€ç—…æ¯’å®šä¹‰åº“</span>
                                </div>
                                <div class="db-version-item">
                                    <span class="db-name">Bytecodeï¼ˆå­—èŠ‚ç ï¼‰</span>
                                    <span class="db-version">{{ virusVersion.bytecode || 'æœªçŸ¥' }}</span>
                                    <span class="db-desc">å¯æ‰§è¡Œç­¾åï¼Œæ£€æµ‹å¤æ‚å¨èƒ</span>
                                </div>
                            </div>
                        </div>
                        <h4>æ›´æ–°å†å²</h4>
                        <div v-if="updateHistory.length === 0" class="empty-state">
                            <p>æš‚æ— æ›´æ–°å†å²</p>
                        </div>
                        <div v-else class="update-list">
                            <div v-for="update in updateHistory" :key="update.id" class="update-item">
                                <div class="update-info">
                                    <h4>{{ update.old_version }} â†’ {{ update.new_version }}</h4>
                                    <p>{{ new Date(update.update_time * 1000).toLocaleString() }}</p>
                                    <span class="status-badge" :class="update.status">{{ update.status }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è®¾ç½® -->
                    <div v-show="activeTab === 'settings'" class="tab-content">
                        <div class="settings-form">
                            <div class="form-group">
                                <label>æ‰«æè·¯å¾„</label>
                                <textarea v-model="config.scan_paths" rows="3" placeholder="/&#10;/home&#10;/mnt/data"></textarea>
                                <small>æ¯è¡Œä¸€ä¸ªè·¯å¾„</small>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" v-model="config.auto_update">
                                    è‡ªåŠ¨æ›´æ–°ç—…æ¯’åº“
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" v-model="config.quarantine_enabled">
                                    å¯ç”¨éš”ç¦»åŒº
                                </label>
                            </div>
                            <div class="form-group">
                                <label>å¨èƒå¤„ç†æ–¹å¼</label>
                                <select v-model="config.threat_action">
                                    <option value="quarantine">éš”ç¦»</option>
                                    <option value="remove">åˆ é™¤</option>
                                    <option value="ignore">ä»…è®°å½•</option>
                                </select>
                            </div>
                            <button class="action-btn primary" @click="saveConfig">ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>
                </section>
            </main>

            <!-- é€šçŸ¥æç¤º -->
            <div v-if="notification.show" class="notification" :class="notification.type">
                {{ notification.message }}
            </div>
        </div>
    </div>

    <script src="./js/app.js"></script>
</body>
</html>
